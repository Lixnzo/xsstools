<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/graphs.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/graph.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="nav">
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#.buildUrl">buildUrl</a></li><li data-type='method'><a href="module-utils.html#.createElement">createElement</a></li><li data-type='method'><a href="module-utils.html#.createFrame">createFrame</a></li><li data-type='method'><a href="module-utils.html#.loadUglify">loadUglify</a></li><li data-type='method'><a href="module-utils.html#.randInt">randInt</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="ClickJacker.html">ClickJacker</a><ul class='methods'><li data-type='method'><a href="ClickJacker.html#addStep">addStep</a></li><li data-type='method'><a href="ClickJacker.html#run">run</a></li></ul></li><li><a href="Exfiltrators.html">Exfiltrators</a><ul class='methods'><li data-type='method'><a href="Exfiltrators.html#.console">console</a></li><li data-type='method'><a href="Exfiltrators.html#.get">get</a></li><li data-type='method'><a href="Exfiltrators.html#.iframe">iframe</a></li><li data-type='method'><a href="Exfiltrators.html#.img">img</a></li><li data-type='method'><a href="Exfiltrators.html#.message">message</a></li><li data-type='method'><a href="Exfiltrators.html#.post">post</a></li><li data-type='method'><a href="Exfiltrators.html#.postJSON">postJSON</a></li><li data-type='method'><a href="Exfiltrators.html#.sendBeacon">sendBeacon</a></li><li data-type='method'><a href="Exfiltrators.html#.style">style</a></li></ul></li><li><a href="MessageHandler.html">MessageHandler</a><ul class='methods'><li data-type='method'><a href="MessageHandler.html#addListener">addListener</a></li><li data-type='method'><a href="MessageHandler.html#listen">listen</a></li><li data-type='method'><a href="MessageHandler.html#logMessages">logMessages</a></li><li data-type='method'><a href="MessageHandler.html#removeListener">removeListener</a></li><li data-type='method'><a href="MessageHandler.html#stop">stop</a></li><li data-type='method'><a href="MessageHandler.html#waitForMessage">waitForMessage</a></li></ul></li><li><a href="Payload.html">Payload</a><ul class='methods'><li data-type='method'><a href="Payload.html#.new">new</a></li><li data-type='method'><a href="Payload.html#addExfiltrator">addExfiltrator</a></li><li data-type='method'><a href="Payload.html#asDOM">asDOM</a></li><li data-type='method'><a href="Payload.html#eval">eval</a></li><li data-type='method'><a href="Payload.html#exfiltrate">exfiltrate</a></li><li data-type='method'><a href="Payload.html#fetch">fetch</a></li><li data-type='method'><a href="Payload.html#fetchDOM">fetchDOM</a></li><li data-type='method'><a href="Payload.html#fetchJSON">fetchJSON</a></li><li data-type='method'><a href="Payload.html#fetchText">fetchText</a></li><li data-type='method'><a href="Payload.html#findBetween">findBetween</a></li><li data-type='method'><a href="Payload.html#forEach">forEach</a></li><li data-type='method'><a href="Payload.html#guard">guard</a></li><li data-type='method'><a href="Payload.html#injectStyle">injectStyle</a></li><li data-type='method'><a href="Payload.html#log">log</a></li><li data-type='method'><a href="Payload.html#map">map</a></li><li data-type='method'><a href="Payload.html#parallel">parallel</a></li><li data-type='method'><a href="Payload.html#passthru">passthru</a></li><li data-type='method'><a href="Payload.html#persist">persist</a></li><li data-type='method'><a href="Payload.html#postMessage">postMessage</a></li><li data-type='method'><a href="Payload.html#postMultipart">postMultipart</a></li><li data-type='method'><a href="Payload.html#querySelector">querySelector</a></li><li data-type='method'><a href="Payload.html#querySelectorAll">querySelectorAll</a></li><li data-type='method'><a href="Payload.html#redirect">redirect</a></li><li data-type='method'><a href="Payload.html#regExtract">regExtract</a></li><li data-type='method'><a href="Payload.html#setExfiltrator">setExfiltrator</a></li><li data-type='method'><a href="Payload.html#startClickLogger">startClickLogger</a></li><li data-type='method'><a href="Payload.html#startKeyLogger">startKeyLogger</a></li><li data-type='method'><a href="Payload.html#wait">wait</a></li></ul></li><li><a href="Wrapper.html">Wrapper</a><ul class='methods'><li data-type='method'><a href="Wrapper.html#.new">new</a></li><li data-type='method'><a href="Wrapper.html#wrap">wrap</a></li></ul></li><li><a href="Wrapper_HTML.html">Wrapper_HTML</a><ul class='methods'><li data-type='method'><a href="Wrapper_HTML.html#append">append</a></li><li data-type='method'><a href="Wrapper_HTML.html#dataUrl">dataUrl</a></li><li data-type='method'><a href="Wrapper_HTML.html#dataUrl64">dataUrl64</a></li><li data-type='method'><a href="Wrapper_HTML.html#enclose">enclose</a></li><li data-type='method'><a href="Wrapper_HTML.html#iframe">iframe</a></li><li data-type='method'><a href="Wrapper_HTML.html#innerHTML">innerHTML</a></li><li data-type='method'><a href="Wrapper_HTML.html#prepend">prepend</a></li><li data-type='method'><a href="Wrapper_HTML.html#wrap">wrap</a></li><li data-type='method'><a href="Wrapper_HTML.html#write">write</a></li></ul></li><li><a href="Wrapper_HTMLDataUrl.html">Wrapper_HTMLDataUrl</a><ul class='methods'><li data-type='method'><a href="Wrapper_HTMLDataUrl.html#iframe">iframe</a></li><li data-type='method'><a href="Wrapper_HTMLDataUrl.html#windowOpen">windowOpen</a></li><li data-type='method'><a href="Wrapper_HTMLDataUrl.html#wrap">wrap</a></li></ul></li><li><a href="Wrapper_JS.html">Wrapper_JS</a><ul class='methods'><li data-type='method'><a href="Wrapper_JS.html#append">append</a></li><li data-type='method'><a href="Wrapper_JS.html#appendScript">appendScript</a></li><li data-type='method'><a href="Wrapper_JS.html#dataUrl">dataUrl</a></li><li data-type='method'><a href="Wrapper_JS.html#dataUrl64">dataUrl64</a></li><li data-type='method'><a href="Wrapper_JS.html#enclose">enclose</a></li><li data-type='method'><a href="Wrapper_JS.html#evalB64">evalB64</a></li><li data-type='method'><a href="Wrapper_JS.html#evalStringForCharCode">evalStringForCharCode</a></li><li data-type='method'><a href="Wrapper_JS.html#imgError">imgError</a></li><li data-type='method'><a href="Wrapper_JS.html#inputFocus">inputFocus</a></li><li data-type='method'><a href="Wrapper_JS.html#minify">minify</a></li><li data-type='method'><a href="Wrapper_JS.html#prepend">prepend</a></li><li data-type='method'><a href="Wrapper_JS.html#script">script</a></li><li data-type='method'><a href="Wrapper_JS.html#svgLoad">svgLoad</a></li><li data-type='method'><a href="Wrapper_JS.html#templateString">templateString</a></li><li data-type='method'><a href="Wrapper_JS.html#url">url</a></li><li data-type='method'><a href="Wrapper_JS.html#wrap">wrap</a></li></ul></li><li><a href="Wrapper_JSDataUrl.html">Wrapper_JSDataUrl</a><ul class='methods'><li data-type='method'><a href="Wrapper_JSDataUrl.html#script">script</a></li><li data-type='method'><a href="Wrapper_JSDataUrl.html#scriptImport">scriptImport</a></li><li data-type='method'><a href="Wrapper_JSDataUrl.html#wrap">wrap</a></li></ul></li><li><a href="Wrapper_JSUrl.html">Wrapper_JSUrl</a><ul class='methods'><li data-type='method'><a href="Wrapper_JSUrl.html#embed">embed</a></li><li data-type='method'><a href="Wrapper_JSUrl.html#iframe">iframe</a></li><li data-type='method'><a href="Wrapper_JSUrl.html#object">object</a></li><li data-type='method'><a href="Wrapper_JSUrl.html#redirect">redirect</a></li><li data-type='method'><a href="Wrapper_JSUrl.html#wrap">wrap</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">utils.js</h1>
    

    <!--container.tmpl-->




    <!--source.tmpl-->

    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module
 */
import Payload from "./Payload.js"

/**
 * Load uglify from unpkg.com, required by Wrapper_JS.minify()
 * @returns {Function} the minify function from uglifiyjs
 */
export async function loadUglify() {
    // Uglify is not really made to run in the browser
    // We need to load each file in the right order or it wont work

    if (window.minify) {
        // already loaded
        return
    }
    const loadScript = (src) => {
        return new Promise(resolve => {
            const script = document.createElement("script")
            script.async = false
            script.defer = true
            script.src = src
            script.onload = resolve
            document.body.appendChild(script)

        })
    }

    const files = [
        "minify.js",
        "utils.js",
        "ast.js",
        "parse.js",
        "transform.js",
        "scope.js",
        "output.js",
        "compress.js",
        "propmangle.js",
    ]


    await Promise.all(files.map(filename => loadScript(`https://unpkg.com/uglify-js@3.13.0/lib/${filename}`)))
    return window.minify
}

// poor man jquery
export const $ = (s) => document.querySelector(s);
export const $$ = (s) => Array.from(document.querySelectorAll(s));

/**
 * Create an html element with given attributes and children element
 * @param {String} tag Tag name for the element 
 * @param {Object} [attr=null] Attributes to add to the elements
 * @param {Array} [children=[]] Array of HTMLElement to add as children
 * @returns {HTMLElement} The created html element
 */
export function createElement(tag, attr = null, children = []) {
    const el = document.createElement(tag)
    if (attr !== null) {
        if ("style" in attr) {
            Object.assign(el.style, attr.style)
            delete attr.style
        }
        Object.assign(el, attr)
    }
    for (const child of children) {
        el.appendChild(child)
    }
    return el
}

export function isCallable(f) {
    return typeof f === "function" || f instanceof Payload
}

export function repr(s) {
    if (isCallable(s)) {
        return s.toString()
    }
    if (Array.isArray(s) &amp;&amp; s.every(f => isCallable(f))) {
        return `[${s.map(f => f.toString()).join(",")}]`
    }
    // Escape / because &lt;/script> can break syntax if some cases
    return JSON.stringify(s).replace("/", "\\/")
}

/**
 * Create an url with get parameters
 *  
 * @param {String} url Base url
 * @param {Object} urlParams object representing parameters
 * @param {String} [hash] Hash to add  
 * @returns {String} The full url with parameters and hash
 */
export function buildUrl(url, urlParams={}, hash = null) {
    const searchParams = new URLSearchParams(urlParams).toString()
    const separator = (url.includes("?") ? "&amp;" : "?")
    const fullHash = hash ? "#" + hash : ""
    return url + separator + searchParams + fullHash
}

// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping
export function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&amp;');
}

// sleep in ms
export const sleep = (ms) => new Promise((r) => window.setTimeout(r, ms));

/** 
 * @alias SandboxAttributes
 * @typedef {Object} SandboxAttributes
 * @property {Boolean} [allow-downloads-without-user-activation=true],
 * @property {Boolean} [allow-downloads=true],
 * @property {Boolean} [allow-forms=true],
 * @property {Boolean} [allow-modals=true],
 * @property {Boolean} [allow-orientation-lock=true],
 * @property {Boolean} [allow-pointer-lock=true],
 * @property {Boolean} [allow-popups=true],
 * @property {Boolean} [allow-popups-to-escape-sandbox=true],
 * @property {Boolean} [allow-presentation=true],
 * @property {Boolean} [allow-same-origin=true],
 * @property {Boolean} [allow-scripts=true],
 * @property {Boolean} [allow-storage-access-by-user-activation=true],
 * @property {Boolean} [allow-top-navigation=true],
 * @property {Boolean} [allow-top-navigation-by-user-activation=true],
 */



/**
 * Create a new iframe element
 *
 * @param {string} url Url for the frame
 * @param {string} [name=null] name of the frame
 * @param {SandboxAttributes} sandbox reverse sandbox option
 * @returns {HTMLElement} The iframe created
 */
export function createFrame(url, name = null, sandbox = {}) {
    const allowAll = {
        "allow-downloads-without-user-activation": true,
        "allow-downloads": true,
        "allow-forms": true,
        "allow-modals": true,
        "allow-orientation-lock": true,
        "allow-pointer-lock": true,
        "allow-popups": true,
        "allow-popups-to-escape-sandbox": true,
        "allow-presentation": true,
        "allow-same-origin": true,
        "allow-scripts": true,
        "allow-storage-access-by-user-activation": true,
        "allow-top-navigation": true,
        "allow-top-navigation-by-user-activation": true,
    };
    const sandboxAttr = Object.entries({ ...allowAll, ...sandbox })
        .filter(([k, v]) => v)
        .map(([k, v]) => k)
        .join(" ");

    return createElement("iframe", {
        sandbox: sandboxAttr,
        name,
        src: url,
    });
}

/**
 * Return a random integer between min and max
 * @param {number} min lower bound
 * @param {number} max upper bound
 * @returns {number}
 */
export function randInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Sun Mar 14 2021 13:45:10 GMT+0100 (Central European Standard Time) using the LOKE theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script>window.addEventListener("DOMContentLoaded", initGraphs)</script>
</body>
</html>
